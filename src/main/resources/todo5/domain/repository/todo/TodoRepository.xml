<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="todo5.domain.repository.todo.TodoRepository">
	<resultMap id="todoResultMap" type="Todo">
		<id property="todoId" column="todo_id" />
		<result property="todoTitle" column="todo_title" />
		<result property="finished" column="finished" />
		<result property="createdAt" column="created_at" />
		<result property="todoCategory" column="category_id" />
		<result property="todoCategoryName" column="category_nm" />
		<result property="firstName" column="firstname" />
		<result property="lastName" column="lastname" />
		<result property="fullName" column="fullname" />
		<result property="todoPriority" column="priority" />
		<result property="cmt" column="remarks" />
	</resultMap>

	<select id="findOne" parameterType="String" resultMap="todoResultMap">
	<![CDATA[
		SELECT
			todo_id,
			todo_title,
			finished,
			created_at,
			category_nm,
			fullname,
			priority,
			remarks
		FROM
			todo t1
				INNER JOIN 
					category t2
				ON t1.category_id = t2.category_id 
		WHERE
			todo_id = #{todoId}
		AND finished = false 
	]]>
	</select>

	<select id="countTodo" resultType="Long">
	<![CDATA[
		SELECT 
			COUNT(*) 
		FROM
			todo t1
				INNER JOIN 
					category t2
				ON t1.category_id = t2.category_id 
					
	]]>
	</select>

	<select id="findAll" resultMap="todoResultMap">
	<![CDATA[
		SELECT
			todo_id,
			todo_title,
			finished,
			created_at,
			priority,
			fullname,
			remarks,
			category_nm
		FROM
			todo t1
				INNER JOIN 
					category t2
				ON t1.category_id = t2.category_id 
					
	]]>
	</select>

	<insert id="create" parameterType="Todo">
	<![CDATA[
		INSERT INTO todo
			(
			todo_id,
			todo_title,
			finished,
			created_at,
			category_id,
			firstname,
			lastname,
			fullname,
			priority,
			remarks
			)
		VALUES
			(
			#{todoId},
			#{todoTitle},
			#{finished},
			#{createdAt},
			#{todoCategory},
			#{firstName},
			#{lastName},
			#{fullName},
			#{todoPriority},
			#{cmt}
			)
	]]>
	</insert>

	<update id="update" parameterType="Todo">
	<![CDATA[
		UPDATE todo
		SET
			todo_title = #{todoTitle},
			finished = #{finished},
			created_at = #{createdAt}
		WHERE
			todo_id = #{todoId}
	]]>
	</update>

	<delete id="delete" parameterType="Todo">
	<![CDATA[
		DELETE FROM
			todo
		WHERE
			todo_id = #{todoId}
	]]>
	</delete>
	
	<select id="countByFinished" parameterType="Boolean" resultType="Long">
	<![CDATA[
		SELECT
			COUNT(*)
		FROM
			todo
		WHERE
			finished = #{finished}
	]]>
	</select>
</mapper>